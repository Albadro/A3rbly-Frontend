<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>أعربلي</title>
        <link rel="stylesheet" href="style/pplo.css" />
        <link rel="stylesheet" href="style/main.css" />
    </head>
    <body>
        <div id="chatbox" class="wrapper">
            <h1 class="special">أعربلي</h1>
            <p class="warn">
                لتفادي الأخطاء يرجى كتابة الجملة بلغةٍ عربيةٍ صحيحة
            </p>
            <input
                type="text"
                id="user_input"
                placeholder="اكتب أي جملة للحصول على إعرابها"
                class="text-input"
            />
            <button id="send_button" class="send-btn">أعرب</button>
            <div id="response" class="response-box invisible"></div>

            <footer>
                <p>
                    يمكن ل <span class="special">أعربلي</span> أن يخطئ، ليس
                    دقيقاً بنسبة 100%
                </p>
                <p>
                    تطوير
                    <a href="https://pplo.dev" target="_blank" class="special"
                        >يوسف ببلو</a
                    >
                </p>
                <p>
                    تطوير الواجهة
                    <a
                        href="mailto:albadrmohammad.dev@gmail.com"
                        target="_blank"
                        class="special"
                        >البدر محمد</a
                    >
                </p>
                <p>
                    صنع في <span class="red">م</span><span>ص</span
                    ><span class="black">ر</span>
                </p>
                <p>جميع الحقوق محفوظة &copy;</p>
            </footer>
        </div>

        <script>
            sendFakeMessage();
            const sendButton = document.getElementById("send_button");
            // Add event listener to respond on click
            sendButton.addEventListener("click", sendFakeMessage);
            // Add event listener to detect Enter key press and send the message
            document
                .getElementById("user_input")
                .addEventListener("keypress", function (event) {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        // sendMessage();
                        sendFakeMessage();
                    }
                });
            function sendFakeMessage() {
                // temp function to test the responses for frontend
                console.log("we are faking a message");
                const responseBox = document.getElementById("response");
                responseBox.innerHTML = `<p>صف ذا ثنا كم جاد شخص قد سما دم طيبا زد في تقى ضع ظالما:</p>
<p>  صف: فعل أمر مبني على السكون</p>
<p> ذا: مفعول به أول منصوب بالالف</p>
<p>  ثنا: مفعول به ثان منصوب بالفتحة</p>
<p>  كم: خبرية مبنية على السكون </p>
<p>  جاد: فعل ماضٍ مبني على الفتح </p>
<p>  شخص: فاعل مرفوع بالضمة </p>
<p> قد: حرف تحقيق مبني على السكون</p>
<p>  سما: فعل ماضٍ مبني على الفتح </p>
<p> دم: فاعل مرفوع بالضمة</p>
<p>  طيبا: حال منصوب بالفتحة</p>
<p>  زد: فعل أمر مبني على السكون</p>
<p>  في: حرف جر مبني على السكون</p>
<p>  التقى: اسم مجرور بالكسرة</p>
<p>  ضع: فعل أمر مبني على السكون</p>
<p>  ظالما: مفعول به منصوب بالفتحة </p>`;
                responseBox.classList.toggle("invisible");
                responseBox.classList.toggle("visible");
            }

            function sendMessage() {
                const userInput = document.getElementById("user_input"); // Get the input element

                const responseBox = document.getElementById("response");

                // Clear the input field and disable the button while processing
                sendButton.classList.add("loading");

                fetch("/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ message: userInput.value }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        sendButton.classList.remove("loading");
                        responseBox.innerHTML = marked.parse(data.response);
                        responseBox.classList.remove("invisible");
                        responseBox.classList.add("visible");

                        // Focus the input field and select its content
                        userInput.focus();
                        userInput.select(); // Select all text in the input field
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        sendButton.classList.remove("loading");
                        responseBox.innerHTML =
                            "An error occurred. Please try again.";
                        responseBox.classList.remove("invisible");
                        responseBox.classList.add("visible");
                    });
            }
        </script>

        <!-- Include the Marked library to parse markdown -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    </body>
</html>
